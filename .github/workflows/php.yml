name: PHP Composer

on:
  push:
    branches: [ test ]
  pull_request:
    branches: [ master ]

jobs:
  tests:
    runs-on: ubuntu-latest
    env:
      # https://github.com/docker/compose/issues/7306
      COMPOSE_INTERACTIVE_NO_CLI: 1
      DOCKER_USER_GID: 1001
      DOCKER_USER_UID: 118
    steps:
      - uses: actions/checkout@v2

      - name: Init project
        run: whoami && id -u && ls -la

      - name: Build
        run: make docker-build up

      - name: docker ls
        run: docker compose exec php-fpm whoami && id -u && ls -la

      - name: docker ls
        run: docker compose exec php-fpm touch test.txt
